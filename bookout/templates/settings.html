
{% extends "maintemplate.html" %}

{% block title %}Settings{% endblock %}

{% block style %}

<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/jquery-ui-1.10.2.custom.min.css') }}" />

{% endblock %}

{% block script %}

<script type="text/javascript" src="{{ url_for('static', filename='js/jquery-ui-1.10.2.custom.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/settings.js') }}"></script>

<script type="text/javascript">

	function submit() {
		if(validate()) {
			$("#validationError").hide();
			$.post("\settings", $("#settingsForm").serialize())
			.done(function() {
				$("#submitSuccess").show();
				$("#submitError").hide();
			}).fail(function() {
				$("#submitError").show();
				$("#submitSuccess").hide();
			});
		}
		else {
			$("#validationError").show();
			$("#submitSuccess").hide();
			$("#submitError").hide();
		}
		
		return false;
	}
	
	function validate() {
		var validates = true;
		
		// Test that lending length is between 1 and 99
		var reLength = /^\d{1,2}$/;
		if(!reLength.test($("#lending_length").val()) || $("#lending_length").val() == "0") {
			validates = false;
			$("#lendingLengthControlGroup").removeClass("success").addClass("error");
			$("#lendingLengthHelp").show();
		}
		else {
			$("#lendingLengthControlGroup").removeClass("error").addClass("success");
			$("#lendingLengthHelp").hide();
		}
		
		// Test that display name has at least one letter or number
		var reName = /\w/;
		if(!reName.test($("#display_name").val())) {
			validates = false;
			$("#display_name").parent().removeClass("success").addClass("error");
			$("#displayNameHelp").show();
		}
		else {
			$("#display_name").parent().removeClass("error").addClass("success");
			$("#displayNameHelp").hide();
		}
		return validates;
	}

</script>

{% endblock %}

{% block content %}

<form id="settingsForm" method="post" action="/settings">

<div class="row">
	<div class="span12">

		<h3>Lending Settings</h3>

		<div id="lendingLengthControlGroup" class="control-group">
			<label for="lending_length" style="display:inline-block">Default lending length (days):</label>
			<input id="lending_length" name="lendingLength" style="width:1.5em;" value="{{ user.lending_length }}" />
			<span id="lendingLengthHelp" class="help-inline" style="display: none;">Must be between 1 and 99.</span>
		</div>
	</div>
</div>

<div class="row">
	<div class="span12">

		<h3>Notifications</h3>
		Receive notifications via:
		<!-- <div class="btn-group">
			<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
				{ Selected Method }
				<span class="caret"></span>
			</a>
			<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
				<li><a tabindex="-1" href="#">Email</a></li>
				<li><a tabindex="-1" href="#">Mobile App</a></li>
				<li><a tabindex="-1" href="#">Both</a></li>
			</ul>
		</div> -->
		<select id="notification_settings" name="notifications" style="vertical-align:baseline">
			<option {% if user.notification == "email" %} selected="true" {% endif %} value="email">Email</option>
			<option {% if user.notification == "mobile" %} selected="true" {% endif %} value="mobile">Mobile App</option>
			<option {% if user.notification == "both" %} selected="true" {% endif %} value="both">Both</option>
		</select>
	</div>
</div>

<div class="row">
	<div class="span12">

		<h3>Manage Network</h3>
		
		<p>Display your connections, add connections via facebook, or invite your friends to join BookOut through the <a href="/network">Network</a> page.</p>

	</div>
</div>

<div class="row">
	<div class="span12">

		<h3>User Profile</h3>
		
		<div class="control-group">
			Display name to connections: 
			<input type="text" id="display_name" name="displayName" value="{{ user.name }}" style="vertical-align:baseline" />
			<span id="displayNameHelp" class="help-inline" style="display: none;">Must have at least one letter or number.</span> 
		</div>
		
		<p>Additional info available to connections:</p>
		
		<textarea name="additionalInfo" style="width:400px;height:125px;"
		placeholder="Enter any additional info you would like to have visible to your contacts, such as your contact info, address, or favorite food."
		>{{ user.info }}</textarea>

	</div>
</div>

</form>

<div class="row">
	<div class="span4">

		<div id="validationError" class="alert alert-error" style="display:none;">
			<strong>Settings not saved!</strong>&nbsp; Fix the errors and try again.
		</div>
		
		<div id="submitError" class="alert alert-error" style="display:none;">
			<strong>Settings not saved!</strong>&nbsp; Something went wrong.
		</div>
		
		<div id="submitSuccess" class="alert alert-success" style="display:none;">
			<strong>Settings saved.</strong>
		</div>

	</div>
</div>

<div class="row">
	<div class="span12">

		<a class="btn btn-inverse" onclick="submit();">
			Save Changes
		</a>
		<!--<a class="btn" href="#">
			Cancel
		</a>-->

	</div>
</div>

<div style="margin-bottom:25px;"></div>

{% endblock %}